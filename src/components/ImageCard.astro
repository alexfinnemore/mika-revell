---
import { getOptimizedImageUrl, generateSrcset, IMAGE_WIDTHS } from '../lib/image';

interface Props {
  image: string;
  alt: string;
  href?: string;
  title?: string;
  aspectRatio?: string;
}

const {
  image,
  alt,
  href,
  title,
  aspectRatio = 'auto'
} = Astro.props;

// Generate optimized image URLs
const optimizedSrc = getOptimizedImageUrl({ src: image, width: 1024 });
const srcset = generateSrcset(image, IMAGE_WIDTHS.card);
const sizes = "(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 33vw";
---

<article class="group relative">
  {href ? (
    <a href={href} class="block overflow-hidden">
      <div
        class="relative overflow-hidden bg-surface"
        style={aspectRatio !== 'auto' ? `aspect-ratio: ${aspectRatio}` : ''}
      >
        <img
          src={optimizedSrc}
          srcset={srcset}
          sizes={sizes}
          alt={alt}
          class="w-full h-full object-cover transition-transform duration-300 ease-out group-hover:scale-[1.02]"
          loading="lazy"
          decoding="async"
        />
      </div>
      {title && (
        <div class="mt-3 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
          <h3 class="text-sm text-text-muted">{title}</h3>
        </div>
      )}
    </a>
  ) : (
    <div class="overflow-hidden">
      <div
        class="relative overflow-hidden bg-surface"
        style={aspectRatio !== 'auto' ? `aspect-ratio: ${aspectRatio}` : ''}
      >
        <img
          src={optimizedSrc}
          srcset={srcset}
          sizes={sizes}
          alt={alt}
          class="w-full h-full object-cover transition-transform duration-300 ease-out group-hover:scale-[1.02]"
          loading="lazy"
          decoding="async"
        />
      </div>
      {title && (
        <div class="mt-3 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
          <h3 class="text-sm text-text-muted">{title}</h3>
        </div>
      )}
    </div>
  )}
</article>
