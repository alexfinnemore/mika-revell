---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection, getEntry } from 'astro:content';

export async function getStaticPaths() {
  const works = await getCollection('works');
  return works.map((work) => ({
    params: { slug: work.data.slug },
    props: { work },
  }));
}

const { work } = Astro.props;

// Get artwork details for each artwork ID in the series
const artworkPromises = work.data.artworks.map((artworkId: string) =>
  getEntry('artworks', artworkId)
);
const artworks = (await Promise.all(artworkPromises)).filter(Boolean);
---

<BaseLayout title={`${work.data.title} - Mika Revell`}>
  <div class="mb-8">
    <a
      href="/work"
      class="text-sm text-text-muted hover:text-accent transition-colors"
    >
      &larr; Back to Work
    </a>
  </div>

  <header class="mb-12">
    <h1 class="text-2xl lg:text-3xl font-semibold mb-2">{work.data.title}</h1>
    {work.data.year && (
      <p class="text-text-muted">{work.data.year}</p>
    )}
    {work.data.description && (
      <p class="mt-4 text-text-muted max-w-2xl">{work.data.description}</p>
    )}
  </header>

  <section class="space-y-8 lg:space-y-12">
    {artworks.map((artwork) => (
      <article id={artwork?.id} class="scroll-mt-20">
        <div class="bg-surface">
          <img
            src={artwork?.data.image}
            alt={artwork?.data.title}
            class="w-full"
            loading="lazy"
          />
        </div>
        <div class="mt-4 space-y-1">
          <h2 class="text-lg">{artwork?.data.title}</h2>
          {artwork?.data.medium && (
            <p class="text-sm text-text-muted">{artwork?.data.medium}</p>
          )}
          {artwork?.data.dimensions && (
            <p class="text-sm text-text-muted">{artwork?.data.dimensions}</p>
          )}
          {artwork?.data.year && (
            <p class="text-sm text-text-muted">{artwork?.data.year}</p>
          )}
          {artwork?.data.description && (
            <p class="text-sm text-text-muted mt-2">{artwork?.data.description}</p>
          )}
        </div>
      </article>
    ))}
  </section>

  {artworks.length === 0 && (
    <div class="text-center py-20 text-text-muted">
      <p>No artworks in this series yet.</p>
    </div>
  )}
</BaseLayout>
