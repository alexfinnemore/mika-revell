---
import BaseLayout from '../../layouts/BaseLayout.astro';
import ImageCard from '../../components/ImageCard.astro';
import { getCollection } from 'astro:content';
import { getOptimizedImageUrl, generateSrcset, IMAGE_WIDTHS } from '../../lib/image';

// Get all work series, filter out hidden ones, and sort by order
const allWorks = await getCollection('works');
const works = allWorks
  .filter(work => !work.data.hidden)
  .sort((a, b) => (a.data.order ?? 999) - (b.data.order ?? 999));
---

<BaseLayout title="Work - Mika Revell">
  <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 lg:gap-8">
    {works.map((work) => (
      <article class="group">
        <a href={`/work/${work.data.slug}`} class="block">
          <div class="overflow-hidden bg-surface mb-4">
            <img
              src={getOptimizedImageUrl({ src: work.data.coverImage, width: 1024 })}
              srcset={generateSrcset(work.data.coverImage, IMAGE_WIDTHS.card)}
              sizes="(max-width: 640px) 100vw, 50vw"
              alt={work.data.title}
              class="w-full aspect-[4/3] object-cover transition-transform duration-300 ease-out group-hover:scale-[1.02]"
              loading="lazy"
              decoding="async"
            />
          </div>
          <h2 class="text-lg font-normal group-hover:text-accent transition-colors">
            {work.data.title}
          </h2>
        </a>
      </article>
    ))}
  </div>

  {works.length === 0 && (
    <div class="text-center py-20 text-text-muted">
      <p>No work series yet.</p>
    </div>
  )}
</BaseLayout>
